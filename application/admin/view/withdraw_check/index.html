{layout name="/common"}
<div class="operate-section">
    <form class="layui-form">
        <div class="layui-inline">
            <div class="layui-input-inline" style="width:250px">
                <input class="layui-input layui-input" name="keyword" placeholder="会员信息" />
            </div>
            <div class="layui-input-inline" style="width:250px">
                <input class="layui-input layui-input" name="address" placeholder="提现地址" />
            </div>
            <div class="layui-input-inline">
                <select name="coin">
                    <option value="">--币种--</option>
                    {foreach $coins as $k => $v}
                    <option value="{$k}">{$v}</option>
                    {/foreach}
                </select>
            </div>
            <button class="btn btn-sm btn-primary" lay-submit lay-filter="search">搜索</button>
            <button class="btn btn-sm btn-white" type="reset">重置</button>
            <a class="btn btn-sm btn-info iframe-refresh"><i class="fa fa-refresh"></i></a>
        </div>
    </form>
</div>
<div class="operate-section">
    <a class="btn btn-sm btn-primary" onclick="check()">审核</a>
    <a class="btn btn-sm btn-info" onclick="complete()">标记已审核</a>
    <a class="btn btn-sm btn-warning" onclick="handleStatus(2)">锁定</a>
    <a class="btn btn-sm btn-warning" onclick="handleStatus(1)">取消锁定</a>
    <a class="btn btn-sm btn-danger" onclick="cancel(4)">取消提现</a>
    <a class="btn btn-sm btn-info export-excel">导出</a>
</div>

<table id="table" lay-filter="table"></table>

<script>
    form.render();
    table.render({
        elem: '#table',
        url : '/admin/withdrawCheck',
        id: 'tableins',
        limit : 20,
        limits : [10,20,30,50],
        page : true,
        height : "full-145",
        cols : [[
            {type: "radio", fixed:"left"},
            {field: 'fId', title: 'ID', align:'center', width: 80},
            {field: 'floginName', title: '会员登陆名', align:'center', width: 150},
            {field: 'fNickName', title: '会员昵称', align:'center', width: 150},
            {field: 'fRealName', title: '会员真实姓名', align:'center', width: 100},
            {field: 'fEmail', title: '会员邮箱', align:'center', width: 200},
            {field: 'fTelephone', title: '会员手机号', align:'center', width: 150},
            {field: 'coin', title: '虚拟币类型', align:'center', width: 300},
            {field: 'fStatus', title: '状态', align:'center', width: 200, templet:function(d){
                    if (d.fStatus == 1) return '待审核';
                    else if (d.fStatus == 2) return '正在处理';
                    else if (d.fStatus == 3) return '已完成';
                    else if (d.fStatus == 4) return '用户取消';
                    else if (d.fStatus == 5) return '审核失败';
                    else return '';

                }},
            {field: 'fAmount', title: '数量', align:'center', width: 150},
            {field: 'ffees', title: '手续费', align:'center', width: 150},
            {field: 'withdraw_virtual_address', title: '提现地址', align:'center', width: 400},
            {field: 'fCreateTime', title: '创建时间', align:'center', width: 200},
            {field: 'flastUpdateTime', title: '更新时间', align:'center', width: 200},
        ]]
    });

    //搜索
    form.on('submit(search)', function(data) {
        table.reload('tableins', {
            page: {
                curr: 1
            },
            where: data.field
        })
        return false;
    })

    //重新审核
    function check () {
        var checkData = table.checkStatus('tableins').data;
        if (checkData.length < 1) {
            error("请选择数据");
            return;
        }
        dialog('/admin/withdrawCheck/check?fId='+checkData[0]['fId'],  '审核', 700);
    }
    //重新审核
    function complete () {
        var checkData = table.checkStatus('tableins').data;
        if (checkData.length < 1) {
            error("请选择数据");
            return;
        }
        dialog('/admin/withdrawCheck/complete?fId='+checkData[0]['fId'],  '审核', 700);
    }


    //取消提现
    function cancel () {
        var checkData = table.checkStatus('tableins').data;
        if (checkData.length < 1) {
            error("请选择数据");
            return;
        }
        layer.confirm('确定执行该操作？', {icon: 3, title: '提示信息'}, function (index) {
            $.post("/admin/withdrawCheck/cancel",{ fId: checkData[0]['fId']}, function(ret) {
                if (ret.code == 0) {
                    table.reload('tableins');
                    success(ret.msg);
                    layer.close(index);
                } else {
                    error(ret.msg);
                }
            })
        })
    }

    //改变状态
    function handleStatus (status) {
        var checkData = table.checkStatus('tableins').data;
        if (checkData.length < 1) {
            error("请选择数据");
            return;
        }
        layer.confirm('确定执行该操作？', {icon: 3, title: '提示信息'}, function (index) {
            $.post("/admin/withdrawCheck/handleStatus",{ fId: checkData[0]['fId'], status: status }, function(ret) {
                if (ret.code == 0) {
                    table.reload('tableins');
                    success(ret.msg);
                    layer.close(index);
                } else {
                    error(ret.msg);
                }
            })
        })
    }
</script>
